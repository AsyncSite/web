# 스터디 멤버 관리: 역할, 책임, 보안 설계 가이드

## 1. 개요

본 문서는 스터디 멤버십 관리 기능과 관련된 역할, 책임, 그리고 보안 아키텍처를 정의합니다. 주요 논의점은 다음과 같습니다.

- 스터디 생성과 멤버 가입이라는 두 가지 핵심 플로우에서 **승인 주체**를 누구로 할 것인가? (어드민 vs 스터디 리더)
- 각 승인 행위는 어느 플랫폼에서 이루어져야 하는가? (`web` vs `backoffice`)
- 프론트엔드에서의 역할(Role) 값 조작 가능성에 어떻게 대비하고 안전한 아키텍처를 구축할 것인가?

## 2. 역할 및 책임(R&R) 정의

서비스의 확장성과 사용자 경험을 고려하여, 승인 흐름을 **스터디 개설**과 **멤버 참여** 두 가지로 명확히 분리하고 각기 다른 주체에게 권한을 부여합니다.

| 구분 | 주체 (Actor) | 행위 (Action) | 플랫폼 (Platform) | 목적 |
| :--- | :--- | :--- | :--- | :--- |
| **스터디 개설** | 스터디 리더 | 스터디 개설 신청 | `web` | 새로운 스터디 생성을 요청 |
| | **어드민** | 개설 신청 승인/반려 | `study-platform-backoffice` | 플랫폼의 품질 관리 및 기준 검토 |
| **멤버 참여** | 일반 사용자 | 스터디 참여 신청 | `web` | 기존 스터디에 멤버로 합류 요청 |
| | **스터디 리더** | 참여 신청 승인/반려 | `web` | 스터디의 목적에 맞는 멤버 선발 |

### 왜 이렇게 설계하는가?

- **권한과 책임의 일치:** 플랫폼 전체를 관리하는 **어드민**은 스터디 개설 승인과 같은 거시적인 관리를, 스터디의 성공을 책임지는 **리더**는 멤버 선발과 같은 미시적인 운영을 담당하는 것이 합리적입니다.
- **확장성:** 모든 멤버 승인을 어드민이 담당할 경우 발생하는 병목 현상을 방지하고, 승인 책임이 각 리더에게 분산되어 서비스가 성장하더라도 유연하게 대처할 수 있습니다.
- **사용자 경험(UX):** 리더가 멤버 관리를 위해 별도의 백오피스에 접근할 필요 없이, 주 사용 공간인 `web` 애플리케이션 내에서 모든 스터디 운영 활동을 완결할 수 있습니다.

## 3. 보안 아키텍처: 안전한 권한 처리

프론트엔드에서의 역할(Role) 값은 신뢰할 수 없다는 원칙(Never trust the client) 하에, 모든 핵심 권한 검증은 백엔드에서 수행합니다.

### JWT 기반 인증/인가 흐름

1.  **로그인 및 서명된 토큰 발급**
    - `user-service`는 사용자의 인증 성공 시, 해당 유저의 고유 ID와 Role (`ROLE_LEADER`, `ROLE_USER` 등)이 포함된 **JWT를 발급**합니다.
    - 이 JWT는 서버의 비밀 키로 **서명**되어 있어, 클라이언트에서의 위변조가 불가능합니다.

2.  **프론트엔드(Web)의 역할: UI 렌더링**
    - 프론트엔드는 JWT에 담긴 Role을 기반으로 UI를 조건부로 렌더링합니다. (e.g., 리더에게만 '멤버 관리' 버튼 노출)
    - 이는 순전히 **사용자 경험(UX)을 위한 처리**이며, 보안의 기준이 되지 않습니다.

3.  **백엔드의 역할: API 요청 검증**
    - 사용자가 특정 액션(e.g., 멤버 승인)을 취하면, 프론트엔드는 JWT를 포함하여 백엔드 API를 호출합니다.
    - **1차 검증 (API 게이트웨이):** `core-platform`의 게이트웨이는 요청된 JWT의 **서명을 검증**하여 토큰의 위변조 여부를 확인합니다. 서명이 유효하지 않으면 요청을 즉시 거부(401 Unauthorized)합니다.
    - **2차 검증 (서비스 로직):** `study-service`는 서명이 검증된 토큰의 사용자 정보(e.g., `userId: 123`)가 **실제로 해당 스터디의 리더가 맞는지** DB 조회 등을 통해 비즈니스 로직 상의 권한을 최종 확인합니다. 권한이 없다면 403 Forbidden을 반환합니다.

### 프론트엔드 보안 강화 (권장 사항)

악의적인 사용자가 프론트엔드 코드를 조작하여 리더 전용 페이지(e.g., `/manage-study`)로 직접 접근하는 경우를 방지하기 위해 다음과 같이 설계합니다.

1.  해당 페이지에 진입하는 즉시, 페이지에 필요한 데이터(e.g., 신청자 목록)를 가져오는 API를 호출합니다.
2.  백엔드는 권한 없는 사용자의 요청에 대해 `403 Forbidden` 에러를 반환합니다.
3.  프론트엔드는 이 에러를 감지하여, 사용자에게 "권한이 없습니다" 메시지를 보여주거나 홈페이지로 리다이렉트 시킵니다.

이러한 설계를 통해, 권한 없는 사용자는 리더용 페이지의 **레이아웃(껍데기)조차 볼 수 없게 되어** 더욱 안전하고 견고한 사용자 경험을 제공할 수 있습니다.
