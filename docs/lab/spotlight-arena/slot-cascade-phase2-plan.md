# Phase 2: 캐스케이드 시스템 상세 기획

## 1. 개요

Phase 2에서는 슬롯머신 캐스케이드의 핵심 메커니즘인 **캐스케이드 시스템**을 구현합니다. 매칭된 심볼이 사라지고 위에서 새로운 심볼이 떨어지며, 연쇄 반응이 일어나면서 점수가 배율로 증가하는 시스템입니다.

## 2. 캐스케이드 메커니즘 상세

### 2.1 기본 동작 흐름

```
1. 초기 스핀 → 그리드 생성
2. 매칭 확인 → 점수 계산
3. 매칭된 심볼 제거 (페이드아웃 애니메이션)
4. 빈 공간으로 위 심볼들이 떨어짐 (중력 효과)
5. 최상단에 새 심볼 생성 및 떨어짐
6. 새로운 매칭 확인
7. 매칭이 있으면 3번으로 돌아가 반복
8. 매칭이 없으면 종료
```

### 2.2 캐스케이드 레벨 시스템

- **레벨 0**: 초기 스핀 (배율 x1)
- **레벨 1**: 첫 번째 캐스케이드 (배율 x1.5)
- **레벨 2**: 두 번째 캐스케이드 (배율 x2)
- **레벨 3**: 세 번째 캐스케이드 (배율 x3)
- **레벨 4+**: 네 번째 이상 (배율 x3 + 보너스 500점)

### 2.3 애니메이션 시퀀스

#### 2.3.1 심볼 제거 애니메이션
- **효과**: 매칭된 심볼이 반짝이며 사라짐
- **시간**: 0.3초
- **구현**: 
  - 스케일 1 → 1.2 → 0
  - 불투명도 1 → 0
  - 반짝임 효과 (glow)

#### 2.3.2 떨어지는 애니메이션
- **효과**: 중력에 의해 심볼이 아래로 떨어짐
- **시간**: 0.4초
- **구현**:
  - translateY 애니메이션
  - ease-in 가속도 효과
  - 떨어지는 거리에 따라 시간 조절

#### 2.3.3 새 심볼 생성 애니메이션
- **효과**: 위에서 새 심볼이 나타나 떨어짐
- **시간**: 0.4초
- **구현**:
  - 초기 위치: translateY(-100%)
  - 페이드인과 함께 떨어짐

### 2.4 특수 심볼 효과 구현

#### 2.4.1 폭탄 (💣) 심볼
- **효과**: 3x3 영역의 모든 심볼 제거
- **점수**: 제거된 심볼들의 총 점수
- **애니메이션**: 폭발 효과 (확산 원형 파동)

#### 2.4.2 스타 (🌟) 심볼
- **효과**: 같은 행과 열의 모든 심볼 제거
- **점수**: 제거된 심볼들의 총 점수
- **애니메이션**: 십자 모양 빛줄기

#### 2.4.3 와일드 (⚡) 심볼
- **효과**: 모든 심볼과 매칭 가능
- **점수**: 매칭된 다른 심볼의 점수
- **애니메이션**: 전기 스파크 효과

#### 2.4.4 보너스 (🎁) 심볼
- **효과**: 50-500점 랜덤 보너스
- **점수**: 랜덤 생성
- **애니메이션**: 선물상자 열리는 효과

## 3. 기술 구현 계획

### 3.1 새로운 유틸리티 함수

#### cascadeUtils.ts
```typescript
// 심볼 떨어뜨리기 로직
export const applyGravity = (grid: (SymbolType | null)[][]): (SymbolType | null)[][] => {
  // 각 열에서 null을 위로, 심볼을 아래로 정렬
}

// 떨어질 위치 계산
export const calculateFallDistance = (grid: (SymbolType | null)[][], row: number, col: number): number => {
  // 해당 심볼이 떨어질 거리 계산
}

// 특수 심볼 효과 적용
export const applySpecialEffects = (grid: (SymbolType | null)[][], position: SymbolPosition): {
  affectedPositions: SymbolPosition[];
  points: number;
}
```

### 3.2 애니메이션 상태 관리

#### 새로운 타입 정의
```typescript
interface AnimationState {
  type: 'removing' | 'falling' | 'appearing';
  positions: SymbolPosition[];
  duration: number;
}

interface CascadeState {
  isProcessing: boolean;
  currentLevel: number;
  animations: AnimationState[];
  totalScore: number;
}
```

### 3.3 컴포넌트 수정

#### SlotGrid 컴포넌트 개선
- 각 셀에 애니메이션 상태 추가
- 애니메이션 클래스 동적 적용
- 특수 효과 렌더링

#### 새 컴포넌트: CascadeEffects
- 특수 심볼 효과 오버레이
- 점수 팝업 애니메이션
- 캐스케이드 레벨 표시

### 3.4 훅 수정

#### useCascadeEffect 훅 추가
```typescript
export const useCascadeEffect = (grid: (SymbolType | null)[][], onComplete: (score: number) => void) => {
  // 캐스케이드 프로세스 관리
  // 애니메이션 시퀀스 제어
  // 점수 계산 및 전달
}
```

## 4. 구현 우선순위

### 4.1 Step 1: 기본 캐스케이드 로직 (2일)
1. 심볼 제거 로직
2. 중력 적용 (떨어뜨리기)
3. 새 심볼 생성
4. 연쇄 반응 감지

### 4.2 Step 2: 애니메이션 구현 (2일)
1. 제거 애니메이션
2. 떨어지는 애니메이션
3. 생성 애니메이션
4. 애니메이션 시퀀싱

### 4.3 Step 3: 특수 심볼 효과 (2일)
1. 폭탄 효과
2. 스타 효과
3. 와일드 매칭
4. 보너스 점수

### 4.4 Step 4: UI/UX 개선 (1일)
1. 점수 팝업
2. 캐스케이드 인디케이터
3. 콤보 표시
4. 사운드 효과 준비

## 5. 성능 고려사항

### 5.1 애니메이션 최적화
- RequestAnimationFrame 사용
- CSS Transform 활용 (GPU 가속)
- 불필요한 리렌더링 방지

### 5.2 상태 업데이트 최적화
- 배치 업데이트
- 메모이제이션 활용
- 애니메이션 중 상태 변경 최소화

### 5.3 메모리 관리
- 애니메이션 완료 후 정리
- 이벤트 리스너 해제
- 타이머 정리

## 6. 테스트 계획

### 6.1 단위 테스트
- 캐스케이드 로직 테스트
- 점수 계산 검증
- 특수 심볼 효과 검증

### 6.2 통합 테스트
- 연속 캐스케이드 시나리오
- 다중 특수 심볼 상호작용
- 애니메이션 시퀀스 검증

### 6.3 성능 테스트
- 50명 동시 플레이 시 FPS
- 메모리 사용량 모니터링
- 애니메이션 부드러움 확인

## 7. 예상 구현 결과

### 7.1 게임플레이 향상
- 더욱 역동적인 게임 진행
- 전략적 요소 증가 (특수 심볼 활용)
- 시각적 만족감 상승

### 7.2 점수 시스템 개선
- 연쇄 반응으로 인한 높은 점수 가능
- 스킬과 운의 균형
- 더 많은 흥미 요소

### 7.3 사용자 경험
- 직관적인 시각적 피드백
- 부드러운 애니메이션
- 명확한 게임 진행 상태 표시